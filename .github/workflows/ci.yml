name: CI
permissions:
    contents: read

on:
    push:
        branches: [ master ]
    pull_request:
        branches: [ master ]

jobs:
    build:
        name: Build & Verify (.op)
        runs-on: windows-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Build plugin (.op)
              shell: pwsh
              run: |
                $ErrorActionPreference = 'Stop'
                Write-Host "Running tools/build-op.ps1 (includes tests)"
                .\tools\build-op.ps1 -IncludeTests

            - name: Verify artifact
              shell: pwsh
              run: |
                Write-Host "Running tools/verify-release.ps1"
                .\tools\verify-release.ps1

            - name: Upload .op artifact
              uses: actions/upload-artifact@v4
              with:
                name: event-calendar-op
                path: event-calendar-dev.op
